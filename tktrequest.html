<html>
<style>
header {
    background-color:black;
    color:white;
    text-align:center;
    padding:5px;
    font-size: 250%;	 
}
content {
    width:100%;
    float:left;
    padding:10px;	 	 
}

footer {
    background-color:black;
    color:white;
    clear:both;
    text-align:center;
    padding:5px;	 	 
}

</style>

<head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/jquery-ui.min.js"></script>
<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">

<script>

// standard functions for processing forms

function sendval(){
   var allreq = [];
   var $formlist = $("#passenger-list :input[type='text']");
   var $list = [];
	$formlist.each(function(){
    var length = $list.push($(this).val());
	});

   var numrows = $list.length/7;
   // first row is the header
   for(i=0; i<numrows; i++) {
   		var myData = {};
		myData.EmpName=localStorage.getItem("username");
	    myData.PassName = $list[i*7+0];
	    myData.DOB = $list[i*7+1];
	    myData.PassNum = $list[i*7+2];
	    myData.PassExp = $list[i*7+3];
	    myData.PassDest = $list[i*7+4];
	    myData.DepDate = $list[i*7+5];
	    myData.ArrDate = $list[i*7+6];
	    myData.Comments = $('#Comments').val();
	    myData.UsrMail = localStorage.getItem("usermail");
	    myData.SupMail = localStorage.getItem("supmail");
   	    myData.Status = 'Submit';
	
	allreq.push(myData);
   }
   
	var myjson = JSON.stringify(allreq);
	
	// now write to php with ajax call
	$.ajaxSetup( { "async": false } );
	$.ajax({
  	method: "POST",
  	url: "submittktreq.php",
  	data: {"points": myjson}
    })
  	.done(function( msg ) {
    	alert(msg);
  		$.ajaxSetup( { "async": true } );  	
    	
    });	
    $('#forminput').text("Now go back to main page");	
}

</script>


<script>   
$(document).ready(function() {
	if (localStorage.getItem("username") === null) {
  	//	$("input[type=button]").hide();
  		window.open("index.html","_self");
	} else {
	// now read the variables in local storage and show buttons accordingly

	var usrname = localStorage.getItem('username');
    var issuper = parseInt(localStorage.getItem('issup'));
    $('#curruser').text(usrname);
    }
});

</script>
</head>

<script>

$(function() {
    
    var $table = $('table.passenger-list'),
        counter = 1;
    
    $('a.add-passenger').click(function(event){
        event.preventDefault();
        counter++;
        var newRow = 
            '<tr>' + 
                '<td><input type="text" required name="Name' + counter + '" id="' + counter + '_name"/></td>' +
                '<td><input type="text" required readonly="true" class="DOB" name="DOB'+ counter + '" id="' + counter + '_DOB"/></td>' +
                '<td><input type="text" required name="PassNum' + counter + '" id="' + counter + '_PassNum"/></td>' +
                '<td><input type="text" required readonly="true" class="PassExpiry" name="PassExpiry' + counter + '" id="' + counter + '_PassExpiry"/></td>' +
                '<td><input type="text" required name="Destination'+ counter + '" id="' + counter + '_Destination"/></td>' +
                '<td><input type="text" required readonly="true" class="DepDate" name="DepDate'+ counter + '" id="' + counter + '_DepDate"/></td>' +
                '<td><input type="text" required readonly="true" class="ArrDate" name="ArrDate'+ counter + '" id="' + counter + '_ArrDate"/></td>' +
                '<td><a class="remove">remove</a></td>'
            '</tr>';
        $table.append(newRow);
        
        $(".DOB").datepicker({
        maxDate:0,
        minDate: "-70Y",
        changeMonth: true,
        changeYear: true
        });

        $(".PassExpiry").datepicker({
        minDate: "+6M",
        changeMonth: true,
        changeYear: true
        });

        $(".ArrDate").datepicker({ 
        minDate: 0,
        maxDate:"+60D",
        numberOfMonths: 2,
        onSelect: function(selected) {
            $("#DepDate").datepicker("option","maxDate", selected)
        }
        });

        $(".DepDate").datepicker({
        minDate: 0,
        maxDate: "+60D",
        numberOfMonths: 2,
        onSelect: function(selected) {
            $("#ArrDate").datepicker("option","minDate", selected)
        }
        });
        
    });
    
    $table.on('click', '.remove', function() {
        $(this).closest('tr').remove();
    });
});
</script>

<header>Green Leaf Airconditioning Services LLC<br>
<br><input type="button" value="Main Page" id="mainpage">    <input type="button" value="Logoff" id="logoff">
</header>

<div id='forminput'>
<label id="curruser"></label><br>

<form id="tktrequest">

<table class="passenger-list" id="passenger-list">
    <tr>
        <th>Name</th>
        <th>D-O-B</th>
        <th>Passport #</th>
        <th>Expiry Date</th>
        <th>Destination</th>
        <th>Departure Date</th>
        <th>Return Date</th>
        <th></th>
    </tr>
    <tr>
        <td><input type="text" name="Name" id="1_name"/></td>
        <td><input type="text" required readonly="true" name="DOB" class = "DOB" id="1_DOB" /></td>
        <td><input type="text" required name="PassNum" id="1_PassNum" /></td>
        <td><input type="text" required readonly="true" name="PassExpiry" class="PassExpiry" id ="1_PassExpiry"/></td>
        <td><input type="text" required name="Destination" id="1_Destination"/></td>
        <td><input type="text" required readonly="true" name="DepDate" class="DepDate" id="1_DepDate"/></td>
        <td><input type="text" required readonly="true" name="ArrDate" class = "ArrDate" id="1_ArrDate"/></td>
        <td><a class="remove">remove</a></td>
    </tr>
</table>
<a href="#" title="" class="add-passenger">Add Passenger</a>

<div>
<input type="text" name="Comments" value="Comments" id = "Comments" class="comment-text" />
<p> Please ensure your passport is valid for more than 6 months from your return date </p>
</div>

<input type='button' name='Submit' value="Submit" onclick=sendval()>


</form>
</div>

<script>
$(".DOB").datepicker({
        maxDate:0,
        minDate: "-70Y",
        changeMonth: true,
        changeYear: true
        });

$(".PassExpiry").datepicker({
        minDate: "+6M",
        changeMonth: true,
        changeYear: true
        });
        
$(".DepDate").datepicker({
        minDate: 0,
        maxDate: "+60D",
        numberOfMonths: 2,
        onSelect: function(selected) {
            $(".ArrDate").datepicker("option","minDate", selected)
        }
    });
    
$(".ArrDate").datepicker({ 
        minDate: 0,
        maxDate:"+60D",
        numberOfMonths: 2,
        onSelect: function(selected) {
            $(".DepDate").datepicker("option","maxDate", selected)
        }
    });

</script>

<script>
$('#mainpage').click(function(){
      window.open("index.html","_self");
});

$('#logoff').click(function(){
   localStorage.clear();
   window.open("index.html","_self");
});

</script>
</html>