<html>
<style>
header {
    background-color:black;
    color:white;
    text-align:center;
    padding:5px;
    font-size: 250%;	 
}
content {
    width:100%;
    float:left;
    padding:10px;	 	 
}

footer {
    background-color:black;
    color:white;
    clear:both;
    text-align:center;
    padding:5px;	 	 
}

</style>

<head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/jquery-ui.min.js"></script>
<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
<script src="tktrequest.js"></script>

<script>

// standard functions for processing forms

function sendval(){
   var allreq = [];
   var $formlist = $("#timeslots :input[type='text']");
   var $list = [];
	$formlist.each(function(){
    var length = $list.push($(this).val());
	});

   var numrows = $list.length/5;
   // first row is the header
   for(i=0; i<numrows; i++) {
   		var myData = {};
		myData.EmpName=localStorage.getItem("username");
	    myData.TSDate = $list[i*5+0];
	    myData.JobTkt = $list[i*5+1];
	    myData.StartTime = $list[i*5+2];
	    myData.EndTime = $list[i*5+3];
	    myData.Comments = $list[i*5+4];
	    myData.UsrMail = localStorage.getItem("usermail");
	    myData.SupMail = localStorage.getItem("supmail");
   	    myData.Status = 'Submit';
	
	allreq.push(myData);
   }
   var myjson = JSON.stringify(allreq);

   // now write to php with ajax call
	$.ajaxSetup( { "async": false } );
	$.ajax({
  	method: "POST",
  	url: "submittimesh.php",
  	data: {"points": myjson}
    })
  	.done(function( msg ) {
    	alert(msg);
  		$.ajaxSetup( { "async": true } );  	
    	
    });	
    $('#forminput').text("Now go back to main page");	

}

</script>

<script>

$(function() {
    
    var $table = $('table.timeslots'),
        counter = 1;
    
    $('a.add-passenger').click(function(event){
        event.preventDefault();
        counter++;
        var newRow = 
            '<tr>' + 
        '<td><input required type="text" readonly="true" name="TSDate' + counter + '" class= "TSDate" id="' + counter + '_TSDate"/></td>' +
        '<td><input required type="text" name="JobTkt' + counter + '" id="' + counter + '_JobTkt" /></td>' +
        '<td><input required type="text" name="StartTime' + counter + '" class= "StartTime"id="' + counter + '_StartTime" /></td>' +
        '<td><input required type="text" name="EndTime' + counter + '" class= "EndTime"id="' + counter + '_EndTime" /></td>' +
        '<td><input type="text" name="Description' + counter + '" id="' + counter + '_Description" value="Description"/></td>' +
        '<td><a class="remove">remove</a></td>'
        '</tr>';
        $table.append(newRow);
        
        $(".TSDate").datepicker({ 
        minDate: "-4D",
        maxDate: 0,
        defaultDate: 0
        });

        
    });
    
    $table.on('click', '.remove', function() {
        $(this).closest('tr').remove();
    });
});
</script>

<script>   
$(document).ready(function() {
	if (localStorage.getItem("username") === null) {
  	//	$("input[type=button]").hide();
  		window.open("index.html","_self");
	} else {
	// now read the variables in local storage and show buttons accordingly

	var usrname = localStorage.getItem('username');
    var issuper = parseInt(localStorage.getItem('issup'));
    $('#curruser').text(usrname);
    }
});

</script>
</head>


<header>Green Leaf Airconditioning Services LLC<br>
<br><input type="button" value="Main Page" id="mainpage">    <input type="button" value="Logoff" id="logoff">
</header>

<div id='forminput'>
<label id="curruser"></label><br>

<form id="timesheet">

<table class="timeslots" id="timeslots">
    <tr>
        <th>Date</th>
        <th>Job Ticket</th>
        <th>Start Time</th>
        <th>End Time</th>
        <th>Description</th>
        <th> </th>
    </tr>
    <tr>
        <td><input required type="text" readonly="true" name="TSDate" class= "TSDate" id="1_TSDate"/></td>
        <td><input required type="text" name="JobTkt" id="1_JobTkt" /></td>
        <td><input required type="text" name="StartTime" class= "SlotStart"id="1_StartTime" /></td>
        <td><input required type="text" name="EndTime" class= "SlotEnd"id="1_EndTime" /></td>
        <td><input type="text" name="Description" id="1_Description" value="Description"/></td>
        <td><a class="remove">remove</a></td>
    </tr>
</table>
<a href="#" title="" class="add-passenger">Add slot</a>

<br><input type='button' name='Submit' value="Submit" onclick=sendval()>

</form>
</div>

<script>

$(".TSDate").datepicker({ 
        minDate: "-4D",
        maxDate: 0,
        defaultDate: 0
});

</script>


<script>
$('#mainpage').click(function(){
      window.open("index.html","_self");
});

$('#logoff').click(function(){
   localStorage.clear();
   window.open("index.html","_self");
});

</script>
</html>