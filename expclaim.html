<html>
<style>
header {
    background-color:black;
    color:white;
    text-align:center;
    padding:5px;
    font-size: 250%;	 
}
content {
    width:100%;
    float:left;
    padding:10px;	 	 
}

footer {
    background-color:black;
    color:white;
    clear:both;
    text-align:center;
    padding:5px;	 	 
}

</style>

<head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/jquery-ui.min.js"></script>
<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">

<script>

// standard functions for processing forms

function sendval(){
   var allreq = [];
   var $formlist = $("#timeslots :input[type='text']");
   
   // get the values of the select elements in a selectlist as well
   var selects = document.getElementsByTagName('select');
   var sel;
   var relevantSelects = [];
   for(var z=0; z<selects.length; z++){
     sel = selects[z];
     relevantSelects.push(sel.options[sel.selectedIndex].text);
    }   
	
	var $list = [];
	$formlist.each(function(){
    var length = $list.push($(this).val());
	});

   var numrows = $list.length/3;
   // first row is the header
   for(i=0; i<numrows; i++) {
   		var myData = {};
		myData.EmpName=localStorage.getItem("username");
	    myData.ExpDate = $list[i*3+0];
	    myData.ExpAmount = $list[i*3+1];
	    myData.Comments = $list[i*3+2];
	    myData.ExpCat = relevantSelects[i];
	    myData.UsrMail = localStorage.getItem("usermail");
	    myData.SupMail = localStorage.getItem("supmail");
   	    myData.Status = 'Submit';
	
	allreq.push(myData);
   }
   
	var myjson = JSON.stringify(allreq);
	
	// now write to php with ajax call
	$.ajaxSetup( { "async": false } );
	$.ajax({
  	method: "POST",
  	url: "submitexpclaim.php",
  	data: {"points": myjson}
    })
  	.done(function( msg ) {
    	alert(msg);
  		$.ajaxSetup( { "async": true } );  	
    	
    });	
    $('#forminput').text("Now go back to main page");	

}

</script>

<script>   
$(document).ready(function() {
	if (localStorage.getItem("username") === null) {
  	//	$("input[type=button]").hide();
  		window.open("index.html","_self");
	} else {
	// now read the variables in local storage and show buttons accordingly

	var usrname = localStorage.getItem('username');
    var issuper = parseInt(localStorage.getItem('issup'));
    $('#curruser').text(usrname);
    }
});

</script>

<script>

$(function() {
    
    var $table = $('table.timeslots'),
        counter = 1;
    
    $('a.add-passenger').click(function(event){
        event.preventDefault();
        counter++;
        var newRow = 
            '<tr>' + 
        '<td><input required type="text" readonly="true" name="TSDate' + counter + '" class= "TSDate" id="' + counter + '_TSDate"/></td>' +
        '<td><select class = "inputvalue" name = "ExpHead" id = "' + counter + '_ExpHead">' +
                 '<option value="Expcat">Expense Category</option>' +
                 '<option value="Fuel">Fuel</option>' +
                 '<option value="Parking">Parking</option>' +
                 '<option value="GatePass">Gate Pass</option>' +
                 '<option value="Lunch">Lunch</option>' +
                 '<option value="Mobile">Mobile</option>' +
                 '<option value="Parts">Parts - Consumables</option>' +
                 '<option value="Postage">Postage - Courier</option>' +
                 '<option value="Taxi">Taxi</option>' +
                 '<option value="Others">Others</option>'+
                 '</select> </td>' +
        '<td><input required  type="text" pattern="[0-9]{3}" name="Amount" id="' + counter + '_Amount" /></td>' +
        '<td><input required  type="text" name="Remarks" id="' + counter + '_Remarks" /></td>' +
        '<td><a class="remove">remove</a></td>'
        '</tr>';
        $table.append(newRow);
        
        $(".TSDate").datepicker({ 
        minDate: "-60D",
        maxDate: 0,
        defaultDate: 0
        });

        
    });
    
    $table.on('click', '.remove', function() {
        $(this).closest('tr').remove();
    });
});
</script>

</head>


<header>Green Leaf Airconditioning Services LLC<br>
<br><input type="button" value="Main Page" id="mainpage">    <input type="button" value="Logoff" id="logoff">
</header>

<div id='forminput'>
<label id="curruser"></label><br>

<form id="expclaim">

<table class="timeslots" id="timeslots">
    <tr>
        <th>Date</th>
        <th>Expense Head</th>
        <th>Claim Amount</th>
        <th>Remarks</th>
        <th> </th>
    </tr>
    <tr>
        <td><input required type="text" readonly="true" name="TSDate" class= "TSDate" id="1_TSDate"/></td>
        <td><select class = "inputvalue" name = "ExpHead" id = "1_ExpHead">
                 <option value="Expcat">Expense Category</option>
                 <option value="Fuel">Fuel</option>
                 <option value="Parking">Parking</option>
                 <option value="GatePass">Gate Pass</option>
                 <option value="Lunch">Lunch</option>
                 <option value="Mobile">Mobile</option>
                 <option value="Parts">Parts - Consumables</option>
                 <option value="Postage">Postage - Courier</option>
                 <option value="Taxi">Taxi</option>
                 <option value="Others">Others</option>
                 </select>
        </td>
        <td><input required type="text" pattern="[0-9]{3}" name="Amount" id="1_Amount" /></td>
        <td><input required type="text" name="Remarks" id="1_Remarks" /></td>
        <td><a class="remove">remove</a></td>
    </tr>
</table>
<a href="#" title="" class="add-passenger">Add Claim</a>

<br><input type='button' name='Submit' value="Submit" onclick=sendval()>

<script>

$(".TSDate").datepicker({ 
        minDate: "-60D",
        maxDate: 0,
        defaultDate: 0
});

</script>

<script>
$('#mainpage').click(function(){
      window.open("index.html","_self");
});

$('#logoff').click(function(){
   localStorage.clear();
   window.open("index.html","_self");
});

</script>
</html>
